# Система опросов пользователей

Приложение с возможностью управления опросами и вопросами для администратора. 
Для пользователей есть возможность анонимно проходить опросы и получать детализацию по пройденным опросам. 


## Функционал

Для администратора системы:
-  авторизация
-  добавление/изменение/удаление опросов
-  добавление/изменение/удаление вопросов в опросе

Для пользователей:
-  получение списка активных опросов
-  прохождение опросов (анонимно, будет сгенерирован уникальный ID для доступа к результатам опросов)
-  детализация по пройденным опросам


## Стэк

| **Описание** | **Технологии и версии** |
|---|----|
| **Версия JDK** | **11** |
| **Сборщик проекта** | **Maven**|
| **Система контроля версий** | **git** |
| **Spring Boot** | **Data, Web, Security (2.4.5)** |
| **PostgreSQL** | **42.2.20**|


## Запуск проекта

Для запуска проекта необходимо передать 5 переменные окружения:
-  **```DB_NAME```** - имя базы данных
-  **```DB_USER```** - имя пользователя для базы данных
-  **```DB_PASSWORD```** - пароль для базы данных
-  **```ADMIN_LOGIN```** - логин администратора
-  **```ADMIN_PASSWORD```** - пароль администратора

Запустить проект можно 2 способами:
   1.  Клонировать с репозитория командой ```git clone https://github.com/FormAToz/studio.fabrique.SurveyService.git``` и запустить в среде разработки, настроив переменные окружения.
   2.  Запустить прилагаемый jar-файл (с заполненными значениями переменных окружения) командой ```java -DDB_NAME=<имя_бд> -DDB_USER=<пользователь_бд> -DDB_PASSWORD=<пароль_бд> -DADMIN_LOGIN=<login> -DADMIN_PASSWORD=<password> -jar SurveyService-1.0-SNAPSHOT.jar```

```Хост``` http://localhost:8080


## Примечание 

В рамках задания не реализовано:

-  регистрация
-  тесты
-  логи


# Документация к API

## Вход - `POST /auth/login`

Метод проверяет введенные данные и производит авторизацию администратора, если введенные данные верны.

**Авторизация:** не требуется

**Запрос:**

```json
{
  "login": "admin",
  "password": "123456"
}
```

* `login` - логин администратора
* `password` - пароль администратора

**Форматы ответов:**
**✅ В случае успешной авторизации:**

```json
{
  "result": true,
  "user": {
    "id": 1,
    "login": "admin",
    "role": "ADMIN"
  }
}
```

**❌ Формат ответа в случае ошибки или нескольких ошибок:**

```json
{
  "result": false,
  "message": "Логин/пароль введены неверно"
}
```


## Выход - `GET /auth/logout`

Метод разлогинивает авторизированного пользователя.

**❗️Авторизация:** требуется

**Формат ответа:**

```json
{"result": true}
```


## Добавление опроса `POST /survey/add`

Метод отправляет данные для создания нового опроса.

**Название, описание и время окончания опроса проверяется на сервере.**

После создания нового опроса, изменить дату старта невозможно.

**❗️Авторизация:** требуется

**Параметры запроса:**

```json
{
  "name": "Опрос_1",
  "description": "Первый опрос",
  "expiration_date": 1640954748
}
```

* `name` - название опроса
* `description` - описание опроса
* `expiration_date` - дата окончания опроса

**✅ Формат успешного ответа:**

```json
{
    "result": true,
    "survey": {
        "id": 1,
        "name": "Опрос_1",
        "description": "Первый опрос",
        "startDate": "2021-05-01 18:52",
        "endDate": "2021-12-31 15:45"
    }
}
```

**❌ Формат ответа в случае ошибки:**

```json
{
    "result": false,
    "message": "Размер текста менее 3 символов"
}
```


## Редактирование опроса `PUT /survey/{id}/update`

Метод изменяет данные существующего опроса по его id.

**❗️Авторизация:** требуется

**Параметры:**

* `id` - id опроса

**Параметры запроса:**

```json
{
  "name": "Опрос_1",
  "description": "Первый опрос - измененный текст",
  "expiration_date": 1640954748
}
```

* `name` - название опроса
* `description` - описание опроса
* `expiration_date` - дата окончания опроса

**✅ Формат успешного ответа:**

```json
{
    "result": true,
    "survey": {
        "id": 1,
        "name": "Опрос_1",
        "description": "Первый опрос - измененный текст",
        "startDate": "2021-05-01 18:52",
        "endDate": "2021-12-31 15:45"
    }
}
```

**❌ Формат ответа в случае ошибки:**

```json
{
    "result": false,
    "message": "Опроса с id = 3 не существует"
}
```


## Удаление опроса `DELETE /survey/{id}`

Метод удаляет опрос из базы по его id.

**❗️Авторизация:** требуется

**✅ Формат успешного ответа:**

```json
{
    "result": true
}
```

**❌ Формат ответа в случае ошибки:**

```json
{
    "result": false,
    "message": "Опроса с id = 3 не существует"
}
```


## Добавление вопроса к опросу `POST /survey/{id}/question`

Метод добавляет новый вопрос к опросу.

**Текст и тип вопроса проверяется на сервере.**

**❗️Авторизация:** требуется

**Параметры:**

* `id` - id опроса

**Параметры запроса:**

```json
{
  "survey_id": 1,
  "text": "Текст вопроса для первого опроса",
  "type": "TEXT"
}
```

* `survey_id` - id опроса
* `text` - текст вопроса
* `type` - тип ответа для вопроса:
  * `TEXT` - ответ с текстом
  * `SINGLE_SELECT` - ответ с выбором одного варианта
  * `MULTI_SELECT` - ответ с выбором нескольких вариантов

**✅ Формат успешного ответа:**

```json
{
    "result": true,
    "question": {
        "id": 1,
        "text": "Текст вопроса для первого опроса",
        "type": "TEXT"
    }
}
```

**❌ Формат ответа в случае ошибки:**

```json
{
    "result": false,
    "message": "Опроса с id = 1 не существует"
}
```


## Изменение существующего вопроса `PUT /survey/question/{id}`

Метод изменяет данные существующего вопроса по его id.

**Текст и тип вопроса проверяется на сервере.**

**❗️Авторизация:** требуется

**Параметры:**

* `id` - id вопроса

**Параметры запроса:**

```json
{
  "text": "Измененный текст и тип вопроса",
  "type": "SINGLE_SELECT"
}
```

* `text` - текст вопроса
* `type` - тип ответа для вопроса:
  * `TEXT` - ответ с текстом
  * `SINGLE_SELECT` - ответ с выбором одного варианта
  * `MULTI_SELECT` - ответ с выбором нескольких вариантов

**✅ Формат успешного ответа:**

```json
{
    "result": true,
    "question": {
        "id": 1,
        "text": "Измененный текст и тип вопроса",
        "type": "SINGLE_SELECT"
    }
}
```

**❌ Формат ответа в случае ошибки:**

```json
{
    "result": false,
    "message": "Вопроса с id = 1 не существует"
}
```


## Удаление вопроса `DELETE /survey/question/{id}`

Метод удаляет вопрос из базы по его id.

**❗️Авторизация:** требуется

**Параметры:**

* `id` - id вопроса

**✅ Формат успешного ответа:**

```json
{
    "result": true
}
```

**❌ Формат ответа в случае ошибки:**

```json
{
    "result": false,
    "message": "Вопроса с id = 1 не существует"
}
```


## Список активных опросов `GET /survey/active`

Получение всех активных постов (у которых не истекла дата окончания).

**Авторизация:** не требуется

**Параметры:**

* `offset` - сдвиг от 0 для постраничного вывода. Если в запросе не задан, принимаем 0 как значение по умолчанию.
* ``limit`` - количество опросов, которое надо вывести. Если в запросе не задан, принимаем 10 как значение по умолчанию.

**Формат ответа:**

```json
[
    {
        "name": "Опрос_1",
        "description": "Первый опрос",
        "startDate": "2021-05-02 01:18",
        "endDate": "2021-12-31 15:45"
    },
    {
        "name": "Опрос_2",
        "description": "Второй опрос",
        "startDate": "2021-05-02 01:18",
        "endDate": "2021-12-31 15:45"
    },
    {
        "name": "Опрос_3",
        "description": "Третий опрос",
        "startDate": "2021-05-02 01:18",
        "endDate": "2021-12-31 15:45"
    },
    {...}
]
```


## Прохождение опроса `POST /survey/pass`

Анонимное прохождение опроса с переданным id пользователя. 
Результат опроса будет сохранен в базе и доступен по сохраненному id пользователя.

**Авторизация:** не требуется

**Параметры запроса:**

```json
{
    "user_id": 7,
    "surveys": [
        {
            "id": 1,
            "questions": [
                {
                    "id": 1,
                    "answer": {
                        "text": "Ответ на 1 вопрос 1 опроса",
                        "type": "MULTI_SELECT"
                    }
                },
                {
                    "id": 2,
                    "answer": {
                        "text": "Ответ на 2 вопрос 1 опроса",
                        "type": "TEXT"
                    }
                },
                {
                    "id": 3,
                    "answer": {
                        "text": "Ответ на 3 вопрос 1 опроса",
                        "type": "SINGLE_SELECT"
                    }
                }
            ]
        },
        {
            "id": 2,
            "questions": [
                {
                    "id": 4,
                    "answer": {
                        "text": "Ответ на 1 вопрос 2 опроса",
                        "type": "SINGLE_SELECT"
                    }
                },
                {
                    "id": 5,
                    "answer": {
                        "text": "Ответ на 2 вопрос 2 опроса",
                        "type": "MULTI_SELECT"
                    }
                }
            ]
        }
    ]
}
```

* `user_id` - уникальный идентификатор пользователя
* `surveys` - список пройденных пользователем опросов
  * `id` - уникальный идентификатор опроса
  * `questions` - список вопросов в каждом опросе
    * `id` - уникальный идентификатор вопроса
    * `answer` - ответ на вопрос
      * `text` - текст ответа на вопрос
      * `type` - тип ответа на вопрос

**✅ Формат успешного ответа:**

```json
{
    "result": true
}
```

**❌ Формат ответа в случае ошибки:**

```json
{
    "result": false,
    "message": "...сообщение об ошибке..."
}
```